{"version":3,"file":"ach.cjs.js","sources":["../../../src/components/ach/ach.tsx"],"sourcesContent":["// Dependencies\nimport type * as Square from '@square/web-sdk';\nimport * as React from 'react';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { PayButton, SvgIcon } from './ach.styles';\nimport type { AchProps, AchWithChildrenProps, AchWithoutChildrenProps } from './ach.types';\nimport { transformPlaidEventName } from './ach.utils';\n\n/**\n * Renders a ACH button to use in the Square Web Payment SDK, pre-styled to meet\n * Square branding guidelines.\n *\n * **_But with the option to override styles or use a custom children_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <Ach />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nexport function Ach(props: AchWithChildrenProps): React.ReactElement;\nexport function Ach(props: AchWithoutChildrenProps): React.ReactElement;\nexport function Ach({\n  accountHolderName,\n  intent,\n  total,\n  redirectURI,\n  transactionId,\n  callbacks,\n  buttonProps,\n  children,\n  svgProps,\n}: AchProps) {\n  const [ach, setAch] = React.useState<Square.ACH | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const { cardTokenizeResponseReceived, payments } = useForm();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n\n  /**\n   * Handle the on click of the ACH button click\n   *\n   * @param e An event which takes place in the DOM.\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\n   */\n  const handleClick = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!ach) {\n      console.warn('ACH button was clicked, but no ACH instance was found.');\n\n      return;\n    }\n\n    try {\n      await ach.tokenize({\n        accountHolderName,\n        intent,\n        total,\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const handlePayment = async (e: Square.SqEvent<Square.TokenizationEvent>) => {\n    setIsSubmitting(true);\n    try {\n      const { tokenResult: result } = e.detail;\n      if (result && result.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result?.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    ach?.addEventListener('ontokenization' as Square.PlaidEventName, handlePayment);\n    return () => {\n      ach?.removeEventListener('ontokenization' as Square.PlaidEventName, handlePayment);\n    };\n  }, [ach]);\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const ach = await payments\n        ?.ach({\n          redirectURI,\n          transactionId,\n        })\n        .then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setAch(res);\n\n          return res;\n        });\n\n      if (signal.aborted) {\n        await ach?.destroy();\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      ach?.addEventListener(\n        transformPlaidEventName(callback) as Square.PlaidEventName,\n        (callbacks as Record<string, (event: Square.SqEvent<Square.TokenizationEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  useEventListener({\n    listener: handleClick,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const { isLoading, ...props } = buttonProps ?? {};\n  const disabled = isLoading || !ach || isSubmitting;\n\n  if (children) {\n    return (\n      <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n        {children}\n      </PayButton>\n    );\n  }\n\n  return (\n    <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n      <SvgIcon\n        fill=\"none\"\n        height=\"1em\"\n        viewBox=\"0 0 36 24\"\n        width=\"1em\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        {...svgProps}\n      >\n        <rect fill=\"url(#prefix__paint0_linear)\" height={24} rx={4} width={36} />\n        <path\n          clipRule=\"evenodd\"\n          d=\"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z\"\n          fill=\"#fff\"\n          fillRule=\"evenodd\"\n        />\n        <defs>\n          <linearGradient gradientUnits=\"userSpaceOnUse\" id=\"prefix__paint0_linear\" x1={36} x2={0} y1={12} y2={12}>\n            <stop stopColor=\"#01D09E\" />\n            <stop offset={1} stopColor=\"#03E4AE\" />\n          </linearGradient>\n        </defs>\n      </SvgIcon>\n      <span>Pay with Direct debit (ACH)</span>\n    </PayButton>\n  );\n}\n\nexport default Ach;\nexport * from './ach.types';"],"names":["Ach","accountHolderName","intent","total","redirectURI","transactionId","callbacks","buttonProps","children","svgProps","ach","setAch","React","isSubmitting","setIsSubmitting","cardTokenizeResponseReceived","payments","useForm","buttonRef","handleClick","e","error","handlePayment","result","message","abortController","signal","res","callback","transformPlaidEventName","useEventListener","isLoading","props","disabled","PayButton","SvgIcon"],"mappings":"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"}